{% extends 'base.html' %}
{% block content %}
{% load groupscheck %}
<div class="container mt-5">
{% if auth_message %}
    <p><strong>{{ auth_message }}</strong></p>
{% else %}
{% if request.user|has_group:"estoque" %}
        {% for message in messages %}
        <div class="container-fluid p-0">
            <div class="alert {{ message.tags }} alert-dismissible" role="alert">
                {{ message }}
            </div>
        </div>
        {% endfor %}
    <section class="container createtkt">
        <div class="row">
            <h2 class="title-cad col-3">Solicitação de Estoque</h2>
        </div><hr>
        <div class="row">
            <form method="post">{% csrf_token %}
            <ul style="margin-left:5rem;list-style:none;">
                <li>Item: <input type="text" id="buscaitem" name="buscaitem" onblur="getVal()"></li>
                <li>Quantidade: <input type="text" name="quant"></li>
                <li>Tamanho: <select id="gettam" name="tamanho">
                                <option selected disabled>Selecione...</option>
                             </select>
                </li>
                <li>Filial: <select name="filial">
                    <option selected disabled>Selecione...</option>
                    {% for k,v in filial %}
                    <option value="{{ k }}">{{ v }}</option>
                    {% endfor %}
                </select></li>
                <li><button>Enviar</button></li>
            </ul>
            </form>
        </div>
    </section>
{% else %}<p>Usuário não tem permissão para acessar</p>{% endif %}
</div>
{% endif %}
<script>
    $(function(){
        var availableTags = [];
            {% for q in autocomplete %}
                if(availableTags.indexOf("{{ q.desc }}") <= -1){
                    availableTags.push("{{ q.desc }}")
                }else{}
            {% endfor %}
        $('#buscaitem').autocomplete({source: availableTags});
    });
    function getVal(){
        field = document.getElementById('buscaitem').value
        var availableTags = []
        {% for q in autocomplete %}
            if("{{q}}" == field){
                availableTags.push("{{ q.tamanho }}")
            }else{}
        {% endfor %}
        var select = document.getElementById('gettam')
        for(i = 0; i < availableTags.length; i++){
            var opt = document.createElement('option');
            opt.value = availableTags[i];
            opt.innerHTML = availableTags[i];
            select.appendChild(opt);
        }
    }
</script>
{% endblock %}